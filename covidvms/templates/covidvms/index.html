{% load static %}
{% include 'covidvms/header.html' %}
<style type="text/css">
            body{
            background-image: url("{% static 'assets/images/file-20200324-155695-1kaxgif.jpg' %}");
            background-repeat: repeat-x;
        }
</style>
<main class="container">
    <br/>
<div class="row justify-content-center mt-5">
    <div class="col-md-12 col-lg-8 col-xl-8">
        <div class="card card-body shadow">
            <br/>
            <div class="row">
                <div class="col-md-12 col-lg-6 col-xl-6">
                    <h4 class="font-weight-bold">LOGIN</h4>
                    <br/>
                    <form action="{% url 'covidvms:login' %}" method="post" id="loginFor">
                        {% csrf_token %}
                        <div class="form-group">
                            <label for="email" class="sr-only">Email</label>
                            <i class="fas fa-envelope text-primary"></i> <input type="email" name="email" class="form-control-custom" placeholder="user email address" autocomplete="off" required/>
                        </div>
                        <div class="form-group">
                            <label for="password" class="sr-only">Password</label>
                            <div class="input-group">
                                <i class="fas fa-lock text-primary"></i> &nbsp;&nbsp;
                                <a href="javascript:void(0)" class="text-primary" id="show-password"><i class="fas fa-eye text-primary"></i></a>
                                <a href="javascript:void(0)" class="text-primary d-none" id="hide-password"><i class="fas fa-eye-slash text-primary"></i></a>
                            </div>
                            <input type="password" name="password" id="password" placeholder="password" class="form-control-custom" autocomplete="off" required/>
                        </div>
                        <div class="form-group">
                            <label for="login" class="sr-only">Login</label>
                            <input type="hidden" name="login" value="1"/>
                            <button type="submit" class="btn btn-info w-100 login-btn">PROCEED</button>
                        </div>
                    </form>
                </div>
                <div class="col-md-12 col-lg-6 col-xl-6">
                    <div class="card card-body border-0">
                        <div class="row justify-content-center">
                                <img src="{% static 'assets/images/covid-19.2.jpg' %}" class="rounded-circle" width="50%" height="150"/>
                        </div>
                        <div class="row justify-content-center">
                            <h1 class="font-weight-bold text-info">CVMS <i class="fas fa-check-circle"></i> </h1>
                        </div>
                    </div>
                </div>
            </div>
            <div class="response"></div>
            <br/>

        </div>
    </div>
</div>
</main>
{% include 'covidvms/footer.html' %}
<script>
    $(document).ready(function () {
        $("#loginFor").on('submit', function (e) {
            e.preventDefault()
            const url = $(this).attr('action')
            $.ajax({
                url: url,
                type: "POST",
                data: $(this).serializeArray(),
                beforeSend: () => {
                    $(".response").html("<span class='spinner-border spinner-border-sm text-info'></span> Authenticating")
                    $(".login-btn").attr("disabled", true)
                },
                success: (data) => {
                    let response = JSON.parse(data)
                    let responseDiv = $(".response");
                    if (response.status === "Authenticated") {
                        responseDiv.addClass('alert alert-success fade show w-50')
                        responseDiv.html("<i class='fas fa-check-circle text-success'></i> " + response.status)
                        window.location.href = response.redirect
                    } else {
                        responseDiv.addClass('alert alert-warning fade show');
                        responseDiv.html("<i class='fas fa-exclamation-triangle text-warning'></i> " + response.status)
                    }
                },
                complete: () => {
                    $(".login-btn").attr("disabled", false);
                }
            });
        });
    });
</script>
</body>
</html>